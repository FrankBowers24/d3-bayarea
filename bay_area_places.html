<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>D3: Bay Area Data by Zip Code</title>
		<script type="text/javascript" src="../d3/d3.v3.js"></script>
		<style type="text/css">
			/* No style rules here yet */		
		</style>
	</head>
	<body>
		<script type="text/javascript">

			//Width and height
			var w = 1000;
			var h = 1000;

			//Define map projection
			var projection = d3.geo.albersUsa()
								   .translate([w/2+16700, h/2+1800])
								   .scale([51000]);

			//Define path generator
			var path = d3.geo.path()
							 .projection(projection);
							 
			//Define quantize scale to sort data values into buckets of color
			
			var color = d3.scale.quantize()
								.range(["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"]);
								

			//Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);




			//Load in irs data
			d3.json("irs.json", function(irs) {


				//Load in GeoJSON data

				function getIRSValue(d) {
					var zip = d.properties.GEOID10;
					var counts = irs[zip];
					if (counts) {
						return +counts[counts.length - 1]/+counts[0];

					} else {
						return null;
					}
				
			    }			



				function getTitle(d) { 
                           	return d.properties.NAME10;
                }

				d3.json("Bay_Area_Places.json", function(json) {


					


					//Bind data and create one path per GeoJSON feature
					svg.selectAll("path")
					   .data(json.features)
					   .enter()
					   .append("path")
					   .attr("d", path)
					   .attr("stroke", "black")
					   .attr("fill", "white")
					   .append("svg:title")
                           .text(function(d) { 
                           	return getTitle(d); });


                   svg.selectAll(".city-label")
					    .data(json.features)
					    .enter()
					    .append("text")
					    .attr("class", function(d) { return "city-label"; })
					    .attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
					   // .attr("dx", function(d) { return (getTitle(d).length * 0.3) + "m") // hack
					    //.attr("dy", function(d) { return path.area(d) > 4000 ? "-1em" : "-.35em"}) //hack
					    .attr('fill', "red")
					    .text(function(d) { return path.area(d) > 2000 ? getTitle(d) : null });
			
			});
        });
				
			
		</script>
	</body>
</html>